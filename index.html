<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>Gestão de Utilizadores</title>
</head>
<body>
  <h2>Utilizadores</h2>

  <input type="text" id="pesquisa" placeholder="Pesquisar por nome">
  <button onclick="listarUtilizadores()">Pesquisar</button>

  <table border="1">
    <thead>
      <tr><th>Nome</th><th>Email</th><th>Ações</th></tr>
    </thead>
    <tbody id="tabela-utilizadores"></tbody>
  </table>

  <h3>Editar Utilizador</h3>
  <input type="hidden" id="id">
  <input type="text" id="nome" placeholder="Nome">
  <input type="email" id="email" placeholder="Email">
  <button onclick="guardarEdicao()">Guardar</button>

  <script type="module">
    // Configuração Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import {
      getFirestore, collection, getDocs, query, where,
      doc, updateDoc, deleteDoc
    } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "A_TUA_API_KEY",
      authDomain: "O_TEU_PROJETO.firebaseapp.com",
      projectId: "O_TEU_PROJETO"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    async function listarUtilizadores() {
      const nomePesquisa = document.getElementById("pesquisa").value.toLowerCase();
      const tabela = document.getElementById("tabela-utilizadores");
      tabela.innerHTML = "";

      const q = nomePesquisa
        ? query(collection(db, "utilizadores"), where("nome", ">=", nomePesquisa), where("nome", "<=", nomePesquisa + '\uf8ff'))
        : collection(db, "utilizadores");

      const snapshot = await getDocs(q);
      snapshot.forEach(docSnap => {
        const dados = docSnap.data();
        const row = `<tr>
          <td>${dados.nome}</td>
          <td>${dados.email}</td>
          <td>
            <button onclick="editar('${docSnap.id}', '${dados.nome}', '${dados.email}')">Editar</button>
            <button onclick="apagar('${docSnap.id}')">Apagar</button>
          </td>
        </tr>`;
        tabela.innerHTML += row;
      });
    }

    window.editar = function(id, nome, email) {
      document.getElementById("id").value = id;
      document.getElementById("nome").value = nome;
      document.getElementById("email").value = email;
    };

    window.guardarEdicao = async function() {
      const id = document.getElementById("id").value;
      const nome = document.getElementById("nome").value;
      const email = document.getElementById("email").value;

      const ref = doc(db, "utilizadores", id);
      await updateDoc(ref, { nome, email });
      alert("Utilizador atualizado!");
      listarUtilizadores();
    };

    window.apagar = async function(id) {
      const ref = doc(db, "utilizadores", id);
      await deleteDoc(ref);
      alert("Utilizador removido!");
      listarUtilizadores();
    };

    listarUtilizadores();
  </script>
</body>
</html>
